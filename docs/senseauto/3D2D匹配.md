3D2D匹配

1. Project3DTo2D
2. 计算所有object对的similarity (O(mn)循环)
3. 

```c++
message ObjectMatchParameter {
    required GraphSolverParameter bipartite_graph_solver_param = 1;
    required SimilarityParameter similarity_param = 2;
    optional float valid_similarity_threshold = 3 [default = 1.0];
    optional float valid_camera_radar_iou_threshold_moving = 4 [default = 0.2];
    optional float valid_camera_radar_iou_threshold_still = 5 [default = 0.2];
    optional VehicleShapeParameter default_vehicle_shape = 6;
    optional float valid_similarity_threshold_moving = 7 [default = 1.0];
    optional float valid_similarity_threshold_still = 8 [default = 1.0];
    optional float max_veh_distance_without_checkout = 9 [default = 100.0];
    optional float max_veh_bus_distance_without_checkout = 10 [default = 100.0];
    optional float max_bike_distance_without_checkout = 11 [default = 100.0];
    optional float max_ped_distance_without_checkout = 12 [default = 100.0];
    optional float max_unkown_distance_without_checkout = 13 [default = 100.0];
    optional string process_label = 14 [default = "VEHICLE"];
    optional CameraMatchingParameter camera_matching_param = 15;
}

message SimilarityParameter {
    repeated SimilarityUnitParameter similarity = 1;
    optional float scale_factor = 2 [default = 1.0];
    optional float invalid_similarity_value = 3 [default = -100.0];
    optional float max_similarity_value = 4 [default = 100.0];
    optional bool use_radar_pos_compensation = 5 [default = false];
}
message SimilarityUnitParameter {
    required SimilarityType similarity_type = 1;
    optional float similarity_weight = 2 [default = 1.0];
    // TODO(zhangshiquan): add gate threshold usage
    optional float gate_threshold = 3;
    optional float upper_gate_threshold = 4;
    optional float lower_gate_threshold = 5;
    optional float bbox_covered_threshold = 6 [default = 0.5];
    optional float scale_factor_unit = 7 [default = 1.0];
    optional float x_weight = 8 [default = 1.0];
    optional float y_weight = 9 [default = 1.0];
    optional float bbox_raw_iou_threshold = 10 [default = 0.25];
    optional float distance_threshold = 11 [default = 8.0];
    optional float velocity_threshold = 12 [default = 10.0];
    optional float direction_delta_threshold =13 [default = 0.52];
    optional float length_scale = 14 [default = 1.2];
    optional float width_scale = 15 [default = 1.1];
    optional bool check_range_velocity = 16 [default = false];
    optional float min_range_velocity = 17 [default = 0.1];
    optional float max_range_velocity_diff = 18 [default = 1];
    optional float lateral_distance_threshold = 19 [default = 3.0];
}


enum SimilarityType {
    CENTER_DISTANCE = 0;
    CENTER_DISTANCE_WEIGHTED = 1;
    DIRECTED_CENTER_DISTANCE = 2;
    DIRECTION = 3;
    SHAPE = 4;
    BBOX_IOUIOSIOT = 5;
    BBOX_CENTER_DISTANCE = 6;
    OBJECT_LABEL = 7;
    BBOX_RAW_IOU = 8;
    AZIMUTH_COS_EXP = 9;
    VELOCITY_WEIGHTED = 10;
    CENTER_DISTANCE_WITH_BBOX_CHECK = 11;
    CENTER_DISTANCE_WEIGHTED_CROSS = 12;
}

```

```
LIDAR_RADAR :DIRECTED_CENTER_DISTANCE
Camera_Lidar : BBOX_RAW_IOU
GeneralTimeAlignSensor1: CENTER_DISTANCE_WITH_BBOX_CHECK
GeneralTimeAlignSensor2: DIRECTED_CENTER_DISTANCE
```

4. BipartiteGraphSolver 二分图求解器

```
message GraphSolverParameter {
    required string bipartite_graph_solver_type = 1
        [default = "KMBipartiteGraphSolver"];
    optional uint32 match_capacity = 2 [default = 1]; //可以连接的数量
}
```



##### 计算Similarity

1. CheckRangeVelocitySimilarity (默认不check)

2. 计算similarity
   1. RAW_IOU算法
      1. get BBOX2D
      2. BBOX2DToVerticals (转换为4个点)
      3. verticals - CheckValidHTransform 其实是check xmin和ymin 是不是满足大小关系
      4. 计算IOU，如果大于阈值（默认为0.25），则再加1，作为similar value
      
   2. Directed_Center_Distance
   
      1. 方位角相差超过π/6则认为不相似
   
      2. 如果横向距离差超过3.5m，也认为不是同一物体
   
      3. 如果纵向距离差超过8m，也认为不是同一物体
   
      4. 计算distance = sqrt(k<sub>x</sub>△x²+k<sub>y</sub>△y²) ,kx和ky为权重系数
   
      5. 
         $$
         similarity = e^{-dist*(-scale+cos\theta-1)}
         $$
         exp函数将任意距离映射到0~1的similarity
   
3. check gate threshold
   
   1. 没有默认上下限
   
4. 再乘以系数 similarity_weight

#### BipartiteGraph

```c++
private:
    bool is_initialized_;
    bool is_solved_;
    float valid_value_threshold_;
    size_t src_element_size_;
    size_t dst_element_size_;
    ConnectedComponentPtr src_connected_component_ptr_;
    ConnectedComponentPtr dst_connected_component_ptr_;
    std::vector<std::vector<float>> graph_;
    std::mutex set_graph_value_mutex_;
class ConnectedComponent {
 public:
    apStatus_t AddConnection(const size_t query_index, const size_t dst_index);

    apStatus_t GetConnectedComponentAll(
        std::vector<std::vector<size_t>>* connected_relation);
    apStatus_t GetConnectedRelationByIndex(
        const size_t query_index, std::vector<size_t>* connected_relation);

    apStatus_t GetConnectIndexList(std::vector<size_t>* index_list);
    apStatus_t GetUnConnectIndexList(std::vector<size_t>* index_list);

 private:
    std::vector<std::vector<size_t>> connected_relation_;
    //将与其连接的点，用list来表示
};  // class ConnectedComponent
```

使用的算法：Kuhn–Munkres Algorithm 使用求解加权二分图最佳完美匹配，时间复杂度O(n³)